+--------------------+--------------------+--------------------+
|                data|            includes|      matching_rules|
+--------------------+--------------------+--------------------+
|[2021-02-13T20:04...|[[[Des Plaines, I...|[[136067812891862...|
|[2021-02-13T20:17...|[[[Magé, Brasil, ...|[[136067812891862...|
|[2021-02-13T20:34...|[[[Sajira, Indone...|[[136067812891862...|
|[2021-02-13T20:36...|[[[Sajira, Indone...|[[136067812891862...|
|[2021-02-13T20:36...|[[[Bogotá, D.C., ...|[[136067812891862...|
|[2021-02-13T20:40...|[[[London, Englan...|[[136067812891862...|
|[2021-02-13T20:42...|[[[Bexley, London...|[[136067812891862...|
|[2021-02-13T20:46...|[[[Pesaro, Marche...|[[136067812891862...|
|[2021-02-13T20:47...|[[[Vicenza, Venet...|[[136067812891862...|
|[2021-02-13T20:50...|[[[Los Angeles, C...|[[136067812891862...|
|[2021-02-13T20:54...|[[[Los Angeles, C...|[[136067812891862...|
|[2021-02-13T21:11...|[[[Manhattan, NY,...|[[136067812891862...|
|[2021-02-13T21:13...|[[[Tambov, Russia...|[[136067812891862...|
|[2021-02-13T21:14...|[[[Paris, France,...|[[136067812891862...|
|[2021-02-13T21:29...|[[[Tunisia, 5ddc8...|[[136067812891862...|
|[2021-02-13T21:31...|[[[Barcelona, Spa...|[[136067812891862...|
+--------------------+--------------------+--------------------+

root
 |-- data: struct (nullable = true)
 |    |-- created_at: string (nullable = true)
 |    |-- geo: struct (nullable = true)
 |    |    |-- coordinates: struct (nullable = true)
 |    |    |    |-- coordinates: array (nullable = true)
 |    |    |    |    |-- element: double (containsNull = true)
 |    |    |    |-- type: string (nullable = true)
 |    |    |-- place_id: string (nullable = true)
 |    |-- id: string (nullable = true)
 |    |-- lang: string (nullable = true)
 |    |-- public_metrics: struct (nullable = true)
 |    |    |-- like_count: long (nullable = true)
 |    |    |-- quote_count: long (nullable = true)
 |    |    |-- reply_count: long (nullable = true)
 |    |    |-- retweet_count: long (nullable = true)
 |    |-- text: string (nullable = true)
 |-- includes: struct (nullable = true)
 |    |-- places: array (nullable = true)
 |    |    |-- element: struct (containsNull = true)
 |    |    |    |-- full_name: string (nullable = true)
 |    |    |    |-- id: string (nullable = true)
 |-- matching_rules: array (nullable = true)
 |    |-- element: struct (containsNull = true)
 |    |    |-- id: long (nullable = true)
 |    |    |-- tag: string (nullable = true)

+-----------------------+
|count(DISTINCT data.id)|
+-----------------------+
|                     16|
+-----------------------+

+-------------------------------+
|count(DISTINCT data.created_at)|
+-------------------------------+
|                             16|
+-------------------------------+

+-----------------------------------------+
|count(DISTINCT includes.places.full_name)|
+-----------------------------------------+
|                                       14|
+-----------------------------------------+

+--------------------+-----+
|           full_name|count|
+--------------------+-----+
|    [Bexley, London]|    1|
|      [Magé, Brasil]|    1|
|   [Los Angeles, CA]|    2|
|[Bogotá, D.C., Co...|    1|
|   [London, England]|    1|
|           [Tunisia]|    1|
|  [Barcelona, Spain]|    1|
|    [Pesaro, Marche]|    1|
|   [Vicenza, Veneto]|    1|
|   [Des Plaines, IL]|    1|
| [Sajira, Indonesia]|    2|
|     [Manhattan, NY]|    1|
|     [Paris, France]|    1|
|    [Tambov, Russia]|    1|
+--------------------+-----+

+--------------------+--------------------+--------------------+----------+
|                data|            includes|      matching_rules|row_number|
+--------------------+--------------------+--------------------+----------+
|[2021-02-13T20:42...|[[[Bexley, London...|[[136067812891862...|         1|
|[2021-02-13T20:17...|[[[Magé, Brasil, ...|[[136067812891862...|         1|
|[2021-02-13T20:50...|[[[Los Angeles, C...|[[136067812891862...|         1|
|[2021-02-13T20:54...|[[[Los Angeles, C...|[[136067812891862...|         2|
|[2021-02-13T20:36...|[[[Bogotá, D.C., ...|[[136067812891862...|         1|
|[2021-02-13T20:40...|[[[London, Englan...|[[136067812891862...|         1|
|[2021-02-13T21:29...|[[[Tunisia, 5ddc8...|[[136067812891862...|         1|
|[2021-02-13T21:31...|[[[Barcelona, Spa...|[[136067812891862...|         1|
|[2021-02-13T20:46...|[[[Pesaro, Marche...|[[136067812891862...|         1|
|[2021-02-13T20:47...|[[[Vicenza, Venet...|[[136067812891862...|         1|
|[2021-02-13T20:04...|[[[Des Plaines, I...|[[136067812891862...|         1|
|[2021-02-13T20:34...|[[[Sajira, Indone...|[[136067812891862...|         1|
|[2021-02-13T20:36...|[[[Sajira, Indone...|[[136067812891862...|         2|
|[2021-02-13T21:11...|[[[Manhattan, NY,...|[[136067812891862...|         1|
|[2021-02-13T21:14...|[[[Paris, France,...|[[136067812891862...|         1|
|[2021-02-13T21:13...|[[[Tambov, Russia...|[[136067812891862...|         1|
+--------------------+--------------------+--------------------+----------+

+------------------------+------+-----------+-----------+--------+----------+
|full_name               |counts|avg_Retweet|avg_Replies|avg_Like|avg_Quotes|
+------------------------+------+-----------+-----------+--------+----------+
|[Sajira, Indonesia]     |2     |0.0        |0.0        |0.5     |0.0       |
|[Los Angeles, CA]       |2     |0.0        |0.0        |0.0     |0.0       |
|[Magé, Brasil]          |1     |0.0        |0.0        |0.0     |0.0       |
|[Bexley, London]        |1     |0.0        |0.0        |0.0     |0.0       |
|[Barcelona, Spain]      |1     |0.0        |0.0        |0.0     |0.0       |
|[Bogotá, D.C., Colombia]|1     |0.0        |0.0        |0.0     |0.0       |
|[Tunisia]               |1     |0.0        |0.0        |1.0     |0.0       |
|[Paris, France]         |1     |0.0        |0.0        |0.0     |0.0       |
|[London, England]       |1     |0.0        |0.0        |0.0     |0.0       |
|[Pesaro, Marche]        |1     |0.0        |0.0        |0.0     |0.0       |
|[Des Plaines, IL]       |1     |0.0        |0.0        |0.0     |0.0       |
|[Manhattan, NY]         |1     |0.0        |0.0        |0.0     |0.0       |
|[Vicenza, Veneto]       |1     |0.0        |0.0        |0.0     |0.0       |
|[Tambov, Russia]        |1     |0.0        |0.0        |1.0     |0.0       |
+------------------------+------+-----------+-----------+--------+----------+

== Parsed Logical Plan ==
'Sort ['counts DESC NULLS LAST], true
+- Aggregate [includes#1.places.full_name], [includes#1.places.full_name AS full_name#118, count(includes#1.places.full_name) AS counts#108L, avg(data#0.public_metrics.retweet_count) AS avg_Retweet#110, avg(data#0.public_metrics.reply_count) AS avg_Replies#112, avg(data#0.public_metrics.like_count) AS avg_Like#114, avg(data#0.public_metrics.quote_count) AS avg_Quotes#116]
   +- Relation[data#0,includes#1,matching_rules#2] json

== Analyzed Logical Plan ==
full_name: array<string>, counts: bigint, avg_Retweet: double, avg_Replies: double, avg_Like: double, avg_Quotes: double
Sort [counts#108L DESC NULLS LAST], true
+- Aggregate [includes#1.places.full_name], [includes#1.places.full_name AS full_name#118, count(includes#1.places.full_name) AS counts#108L, avg(data#0.public_metrics.retweet_count) AS avg_Retweet#110, avg(data#0.public_metrics.reply_count) AS avg_Replies#112, avg(data#0.public_metrics.like_count) AS avg_Like#114, avg(data#0.public_metrics.quote_count) AS avg_Quotes#116]
   +- Relation[data#0,includes#1,matching_rules#2] json

== Optimized Logical Plan ==
Sort [counts#108L DESC NULLS LAST], true
+- Aggregate [includes#1.places.full_name], [includes#1.places.full_name AS full_name#118, count(includes#1.places.full_name) AS counts#108L, avg(data#0.public_metrics.retweet_count) AS avg_Retweet#110, avg(data#0.public_metrics.reply_count) AS avg_Replies#112, avg(data#0.public_metrics.like_count) AS avg_Like#114, avg(data#0.public_metrics.quote_count) AS avg_Quotes#116]
   +- Project [data#0, includes#1]
      +- Relation[data#0,includes#1,matching_rules#2] json

== Physical Plan ==
*(3) Sort [counts#108L DESC NULLS LAST], true, 0
+- Exchange rangepartitioning(counts#108L DESC NULLS LAST, 200)
   +- *(2) HashAggregate(keys=[includes#1.places.full_name#171], functions=[count(includes#1.places.full_name), avg(data#0.public_metrics.retweet_count), avg(data#0.public_metrics.reply_count), avg(data#0.public_metrics.like_count), avg(data#0.public_metrics.quote_count)], output=[full_name#118, counts#108L, avg_Retweet#110, avg_Replies#112, avg_Like#114, avg_Quotes#116])
      +- Exchange hashpartitioning(includes#1.places.full_name#171, 200)
         +- *(1) HashAggregate(keys=[includes#1.places.full_name AS includes#1.places.full_name#171], functions=[partial_count(includes#1.places.full_name), partial_avg(data#0.public_metrics.retweet_count), partial_avg(data#0.public_metrics.reply_count), partial_avg(data#0.public_metrics.like_count), partial_avg(data#0.public_metrics.quote_count)], output=[includes#1.places.full_name#171, count#158L, sum#159, count#160L, sum#161, count#162L, sum#163, count#164L, sum#165, count#166L])
            +- *(1) FileScan json [data#0,includes#1] Batched: false, Format: JSON, Location: InMemoryFileIndex[file:/home/cjen/210104-usf-bigdata/week6/tweetsapp/BTS_geoOnly_210213_2pm-4pm_C..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct<data:struct<created_at:string,geo:struct<coordinates:struct<coordinates:array<double>,type...
(3) MapPartitionsRDD[73] at rdd at Runner.scala:74 []
 |  SQLExecutionRDD[72] at rdd at Runner.scala:74 []
 |  MapPartitionsRDD[71] at rdd at Runner.scala:74 []
 |  MapPartitionsRDD[70] at rdd at Runner.scala:74 []
 |  ShuffledRowRDD[69] at rdd at Runner.scala:74 []
 +-(200) MapPartitionsRDD[68] at rdd at Runner.scala:74 []
     |   MapPartitionsRDD[64] at rdd at Runner.scala:74 []
     |   ShuffledRowRDD[63] at rdd at Runner.scala:74 []
     +-(1) MapPartitionsRDD[62] at rdd at Runner.scala:74 []
        |  MapPartitionsRDD[61] at rdd at Runner.scala:74 []
        |  FileScanRDD[60] at rdd at Runner.scala:74 []
+------------------------+------+-----------+-----------+--------+----------+-----+
|full_name               |counts|avg_Retweet|avg_Replies|avg_Like|avg_Quotes|index|
+------------------------+------+-----------+-----------+--------+----------+-----+
|[Los Angeles, CA]       |2     |0.0        |0.0        |0.0     |0.0       |1    |
|[Sajira, Indonesia]     |2     |0.0        |0.0        |0.5     |0.0       |2    |
|[Bexley, London]        |1     |0.0        |0.0        |0.0     |0.0       |3    |
|[Magé, Brasil]          |1     |0.0        |0.0        |0.0     |0.0       |4    |
|[Bogotá, D.C., Colombia]|1     |0.0        |0.0        |0.0     |0.0       |5    |
|[London, England]       |1     |0.0        |0.0        |0.0     |0.0       |6    |
|[Tunisia]               |1     |0.0        |0.0        |1.0     |0.0       |7    |
|[Barcelona, Spain]      |1     |0.0        |0.0        |0.0     |0.0       |8    |
|[Pesaro, Marche]        |1     |0.0        |0.0        |0.0     |0.0       |9    |
|[Vicenza, Veneto]       |1     |0.0        |0.0        |0.0     |0.0       |10   |
|[Des Plaines, IL]       |1     |0.0        |0.0        |0.0     |0.0       |11   |
|[Manhattan, NY]         |1     |0.0        |0.0        |0.0     |0.0       |12   |
|[Paris, France]         |1     |0.0        |0.0        |0.0     |0.0       |13   |
|[Tambov, Russia]        |1     |0.0        |0.0        |1.0     |0.0       |14   |
+------------------------+------+-----------+-----------+--------+----------+-----+

